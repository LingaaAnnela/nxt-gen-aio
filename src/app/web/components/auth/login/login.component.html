<app-breadcrumb [breadcrumb]="breadcrumb"></app-breadcrumb>
<section class="log-in-section background-image-2 section-b-space">
  <div class="container-fluid-lg w-100">
    <div class="row">
      <div class="col-xxl-6 col-xl-5 col-lg-6 d-lg-block d-none ms-auto">
        <div class="image-contain">
          <img
            src="assets/images/inner-page/log-in.png"
            class="img-fluid"
            alt="log-in"
          />
        </div>
      </div>
      <div class="col-xxl-4 col-xl-5 col-lg-6 col-sm-8 mx-auto">
        <app-alert></app-alert>
        <div class="log-in-box">
          <div class="log-in-title">
            <h3>{{ "welcome_to_next_gen_mart" | translate }}</h3>
            <h4>{{ "sign_in_to_your_account" | translate }}</h4>
          </div>
          <div class="input-box">
            @if (message) {
            <div class="alert alert-info mb-3">
              {{ message }}
            </div>
            } @if (errorMessage) {
            <div class="alert alert-danger mb-1">
              <i class="ri-error-warning-line me-2"></i>
              {{ errorMessage }}
            </div>
            }

            <!-- Login Method Toggle -->
            <div class="login-method-toggle mb-4">
              <div class="btn-group w-100" role="group">
                <button
                  type="button"
                  class="btn login-method-btn"
                  [class.active]="loginMethod === 'email'"
                  (click)="switchLoginMethod('email')"
                >
                  <i class="ri-mail-line me-2"></i>
                  {{ "email_password" | translate }}
                </button>
                <button
                  type="button"
                  class="btn login-method-btn"
                  [class.active]="loginMethod === 'phone'"
                  (click)="switchLoginMethod('phone')"
                >
                  <i class="ri-phone-line me-2"></i>
                  {{ "phone_otp" | translate }}
                </button>
              </div>
            </div>

            <form class="row g-4" [formGroup]="form" (ngSubmit)="submit()">
              @if (loginMethod === 'email') {
              <!-- Email Login -->
              <div class="col-12">
                <div class="form-floating log-in-form">
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    formControlName="email"
                    placeholder="{{ 'email_address' | translate }}"
                  />
                  <label for="email">{{ "email_address" | translate }}</label>
                  @if (form.controls['email'].touched &&
                  form.controls['email'].errors?.['required']) {
                  <div class="invalid-feedback">
                    {{ "email_is_required" | translate }}
                  </div>
                  } @if (form.controls['email'].touched &&
                  form.controls['email'].errors?.['email']) {
                  <div class="invalid-feedback">
                    {{ "invalid_email" | translate }}
                  </div>
                  }
                </div>
              </div>
              <div class="col-12">
                <div class="form-floating log-in-form">
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    formControlName="password"
                    placeholder="{{ 'password' | translate }}"
                  />
                  <label for="password">{{ "password" | translate }}</label>
                  @if (form.controls['password'].touched &&
                  form.controls['password'].errors?.['required']) {
                  <div class="invalid-feedback">
                    {{ "password_is_required" | translate }}
                  </div>
                  } @if (form.controls['password'].touched &&
                  form.controls['password'].errors?.['minlength']) {
                  <div class="invalid-feedback">
                    {{ "password_min_length" | translate }}
                  </div>
                  }
                </div>
              </div>
              } @else {
              <!-- Phone Login -->
              <div class="col-12">
                <div class="form-floating log-in-form">
                  <input
                    type="tel"
                    class="form-control"
                    id="phone"
                    formControlName="phone"
                    placeholder="{{ 'phone_number' | translate }}"
                  />
                  <label for="phone">{{ "phone_number" | translate }}</label>
                  @if (form.controls['phone'].touched &&
                  form.controls['phone'].errors?.['required']) {
                  <div class="invalid-feedback">
                    {{ "phone_is_required" | translate }}
                  </div>
                  } @if (form.controls['phone'].touched &&
                  form.controls['phone'].errors?.['pattern']) {
                  <div class="invalid-feedback">
                    {{ "invalid_phone" | translate }}
                  </div>
                  }
                </div>
              </div>
              }

              <div class="col-12">
                <div class="forgot-box">
                  <div class="form-check ps-0 m-0 remember-box">
                    <input
                      class="checkbox_animated check-box"
                      type="checkbox"
                      id="remeberme"
                    />
                    <label class="form-check-label" for="remeberme">
                      {{ "remember_me" | translate }}
                    </label>
                  </div>
                  <a
                    [routerLink]="['/nxt/auth/forgot-password']"
                    class="forgot-password"
                  >
                    {{ "need_help" | translate }}?
                  </a>
                </div>
              </div>
              <div class="col-12">
                <app-button
                  [id]="'login_btn'"
                  [disabled]="!!(isLoading$ | async)"
                >
                  @if (isLoading$ | async) {
                  <i class="ri-loader-4-line ri-spin me-2"></i>
                  {{ "loading" | translate }}
                  } @else { @if (loginMethod === 'phone') {
                  {{ "send_otp" | translate }}
                  } @else {
                  {{ "sign_in" | translate }}
                  } }
                </app-button>
              </div>
            </form>
          </div>
          <div class="other-log-in">
            <h6>{{ "or" | translate }}</h6>
          </div>
          <div class="social-login-buttons">
            <div class="row g-3">
              <div class="col-6">
                <button
                  [disabled]="isLoading$ | async"
                  type="button"
                  class="btn social-login-btn w-100 d-flex align-items-center justify-content-center"
                  (click)="loginWithGoogle()"
                >
                  <i class="ri-google-fill me-2"></i>
                  {{ "login_with_google" | translate }}
                </button>
              </div>
              <div class="col-6">
                <button
                  [disabled]="isLoading$ | async"
                  type="button"
                  class="btn social-login-btn w-100 d-flex align-items-center justify-content-center"
                  (click)="loginWithFacebook()"
                >
                  <i class="ri-facebook-fill me-2"></i>
                  {{ "login_with_facebook" | translate }}
                </button>
              </div>
            </div>
          </div>
          <div class="sign-up-box">
            <h4>{{ "don't_have_an_account" | translate }}?</h4>
            <a [routerLink]="['/nxt/auth/register']">
              {{ "sign_up" | translate }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
